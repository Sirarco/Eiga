<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CineMatch Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --mint: #e2f3f5; --lavender: #f3e8ff; --peach: #fff1e6; }
        body { background: linear-gradient(135deg, var(--mint), var(--lavender)); min-height: 100vh; color: #2d3748; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 24px; }
        .genre-bubble { transition: all 0.3s ease; cursor: pointer; border: 2px solid transparent; }
        .genre-bubble.selected { transform: scale(1.05); border-color: #8b5cf6; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); }
        .movie-card { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-4 pb-10">

    <div id="user-selection" class="flex flex-col items-center justify-center h-screen space-y-8">
        <h1 class="text-4xl font-black text-purple-900 tracking-tight">CineMatch</h1>
        <div class="flex gap-6">
            <button onclick="selectUser('Maca')" class="flex flex-col items-center">
                <div class="w-20 h-20 bg-pink-200 rounded-full mb-2 border-4 border-white shadow-xl flex items-center justify-center text-3xl">üå∏</div>
                <span class="font-bold">Maca</span>
            </button>
            <button onclick="selectUser('Marco')" class="flex flex-col items-center">
                <div class="w-20 h-20 bg-blue-200 rounded-full mb-2 border-4 border-white shadow-xl flex items-center justify-center text-3xl">üòé</div>
                <span class="font-bold">Marco</span>
            </button>
            <button onclick="selectUser('Vicente')" class="flex flex-col items-center">
                <div class="w-20 h-20 bg-green-200 rounded-full mb-2 border-4 border-white shadow-xl flex items-center justify-center text-3xl">üéÆ</div>
                <span class="font-bold">Vicente</span>
            </button>
        </div>
    </div>

    <div id="app-main" class="hidden max-w-md mx-auto space-y-6">
        <div class="flex justify-between items-center">
            <h2 id="welcome" class="text-2xl font-bold text-purple-900"></h2>
            <button onclick="location.reload()" class="text-xs bg-white/50 px-3 py-1 rounded-full uppercase font-bold">Salir</button>
        </div>

        <section class="glass p-6 shadow-sm">
            <h3 class="text-sm font-bold uppercase text-gray-500 mb-4 tracking-widest">¬øQu√© g√©nero buscamos?</h3>
            <div id="genre-container" class="flex flex-wrap gap-2"></div>
            
            <div class="mt-6">
                <label class="text-xs font-bold uppercase text-gray-400">Regi√≥n</label>
                <select id="region" class="w-full mt-2 p-3 bg-white/50 rounded-xl border-none outline-none font-medium">
                    <option value="US">Hollywood (EE.UU)</option>
                    <option value="ES">Espa√±a</option>
                    <option value="FR">Francia</option>
                    <option value="JP">Jap√≥n</option>
                    <option value="KR">Corea del Sur</option>
                </select>
            </div>

            <button onclick="fetchMovies()" class="w-full mt-8 py-4 bg-purple-600 text-white rounded-2xl font-black text-lg shadow-lg active:scale-95 transition-transform">
                ENCONTRAR PELIS
            </button>
        </section>

        <div id="movie-results" class="space-y-4"></div>
    </div>

    <script>
        // CONFIGURACI√ìN - REEMPLAZAR AQU√ç
        const TMDB_KEY = '366d109fec623ff7a4227017bfd58f0b';
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbwCW3SovPKFtX_w_Ou5pYhVq7AEQRHEJdj19Jz4aFlw8eMrB84UVGVgqZoI3OdVHiJ3/exec';

        let currentUser = "";
        let selectedGenres = [];
        const genres = [
            { id: 28, name: "Acci√≥n", color: "#fee2e2" }, { id: 35, name: "Comedia", color: "#fef3c7" },
            { id: 18, name: "Drama", color: "#e0e7ff" }, { id: 27, name: "Terror", color: "#ddd6fe" },
            { id: 10749, name: "Romance", color: "#fce7f3" }, { id: 878, name: "Sci-Fi", color: "#d1fae5" }
        ];

        function selectUser(user) {
            currentUser = user;
            document.getElementById('user-selection').classList.add('hidden');
            document.getElementById('app-main').classList.remove('hidden');
            document.getElementById('welcome').innerText = `Hola, ${user} ‚ú®`;
            renderGenres();
        }

        function renderGenres() {
            const container = document.getElementById('genre-container');
            genres.forEach(g => {
                const b = document.createElement('div');
                b.className = 'genre-bubble px-4 py-2 rounded-full text-xs font-bold';
                b.style.backgroundColor = g.color;
                b.innerText = g.name;
                b.onclick = () => {
                    if(selectedGenres.includes(g.id)) {
                        selectedGenres = selectedGenres.filter(i => i !== g.id);
                        b.classList.remove('selected');
                    } else if(selectedGenres.length < 3) {
                        selectedGenres.push(g.id);
                        b.classList.add('selected');
                    }
                };
                container.appendChild(b);
            });
        }

        async function fetchMovies() {
            const container = document.getElementById('movie-results');
            container.innerHTML = "<p class='text-center py-10 font-medium text-purple-800 animate-pulse'>Buscando en la base de datos gal√°ctica...</p>";
            
            const genreIds = selectedGenres.join(',');
            const region = document.getElementById('region').value;
            
            try {
                const res = await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_KEY}&with_genres=${genreIds}&with_origin_country=${region}&language=es-ES&sort_by=popularity.desc`);
                const data = await res.json();
                
                container.innerHTML = "";
                data.results.slice(0, 5).forEach(movie => {
                    container.innerHTML += `
                        <div class="glass p-4 movie-card flex gap-4">
                            <img src="https://image.tmdb.org/t/p/w200${movie.poster_path}" class="w-24 h-36 rounded-xl object-cover shadow-md">
                            <div class="flex flex-col justify-between flex-1">
                                <div>
                                    <h4 class="font-black text-lg leading-tight">${movie.title}</h4>
                                    <p class="text-[10px] text-gray-500 mt-1 uppercase font-bold">${movie.release_date.split('-')[0]}</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="saveMovie('${movie.id}', '${movie.title.replace(/'/g, "")}', 'Mucho')" class="flex-1 bg-purple-100 text-purple-700 text-[10px] py-2 rounded-lg font-black uppercase">Quiero Verla</button>
                                    <button onclick="alert('Sinopsis: ${movie.overview.substring(0,100)}...')" class="bg-gray-100 p-2 rounded-lg text-xs">‚ÑπÔ∏è</button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            } catch (e) {
                container.innerHTML = "Error al conectar. Revisa tu API Key.";
            }
        }

        async function saveMovie(id, title, priority) {
            const data = {
                action: 'saveInteraction',
                user: currentUser,
                movie_id: id,
                title: title,
                priority: priority,
                watched: false
            };
            
            await fetch(GAS_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(data)
            });
            
            alert(`¬°Guardado! ${title} se a√±adi√≥ a tu lista en Google Sheets.`);
        }
    </script>
</body>
</html>
